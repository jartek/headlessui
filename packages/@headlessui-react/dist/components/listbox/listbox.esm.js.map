{"version":3,"file":"listbox.esm.js","sources":["../../../src/components/listbox/listbox.tsx"],"sourcesContent":["import React, {\n  Fragment,\n  createContext,\n  createRef,\n  useCallback,\n  useContext,\n  useMemo,\n  useReducer,\n  useRef,\n\n  // Types\n  Dispatch,\n  ElementType,\n  KeyboardEvent as ReactKeyboardEvent,\n  MouseEvent as ReactMouseEvent,\n  MutableRefObject,\n  Ref,\n} from 'react'\n\nimport { useDisposables } from '../../hooks/use-disposables'\nimport { useId } from '../../hooks/use-id'\nimport { useIsoMorphicEffect } from '../../hooks/use-iso-morphic-effect'\nimport { useComputed } from '../../hooks/use-computed'\nimport { useSyncRefs } from '../../hooks/use-sync-refs'\nimport { Props } from '../../types'\nimport { Features, forwardRefWithAs, PropsForFeatures, render } from '../../utils/render'\nimport { match } from '../../utils/match'\nimport { disposables } from '../../utils/disposables'\nimport { Keys } from '../keyboard'\nimport { Focus, calculateActiveIndex } from '../../utils/calculate-active-index'\nimport { isDisabledReactIssue7711 } from '../../utils/bugs'\nimport { isFocusableElement, FocusableMode } from '../../utils/focus-management'\nimport { useWindowEvent } from '../../hooks/use-window-event'\nimport { useOpenClosed, State, OpenClosedProvider } from '../../internal/open-closed'\n\nenum ListboxStates {\n  Open,\n  Closed,\n}\n\ntype ListboxOptionDataRef = MutableRefObject<{\n  textValue?: string\n  disabled: boolean\n  value: unknown\n}>\n\ninterface StateDefinition {\n  value: unknown\n  listboxState: ListboxStates\n  propsRef: MutableRefObject<{ value: unknown; onChange(value: unknown): void }>\n  labelRef: MutableRefObject<HTMLLabelElement | null>\n  buttonRef: MutableRefObject<HTMLButtonElement | null>\n  optionsRef: MutableRefObject<HTMLUListElement | null>\n  disabled: boolean\n  options: { id: string; dataRef: ListboxOptionDataRef }[]\n  searchQuery: string\n  activeOptionIndex: number | null\n}\n\nenum ActionTypes {\n  OpenListbox,\n  CloseListbox,\n\n  SetDisabled,\n\n  GoToOption,\n  Search,\n  ClearSearch,\n\n  RegisterOption,\n  UnregisterOption,\n\n  ChangeValue,\n}\n\ntype Actions =\n  | { type: ActionTypes.CloseListbox }\n  | { type: ActionTypes.OpenListbox }\n  | { type: ActionTypes.SetDisabled; disabled: boolean }\n  | { type: ActionTypes.GoToOption; focus: Focus.Specific; id: string }\n  | { type: ActionTypes.GoToOption; focus: Exclude<Focus, Focus.Specific> }\n  | { type: ActionTypes.Search; value: string }\n  | { type: ActionTypes.ClearSearch }\n  | { type: ActionTypes.RegisterOption; id: string; dataRef: ListboxOptionDataRef }\n  | { type: ActionTypes.UnregisterOption; id: string }\n  | { type: ActionTypes.ChangeValue; value: unknown }\n\nlet reducers: {\n  [P in ActionTypes]: (\n    state: StateDefinition,\n    action: Extract<Actions, { type: P }>\n  ) => StateDefinition\n} = {\n  [ActionTypes.CloseListbox](state) {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Closed) return state\n    return { ...state, activeOptionIndex: null, listboxState: ListboxStates.Closed }\n  },\n  [ActionTypes.OpenListbox](state) {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Open) return state\n    return { ...state, listboxState: ListboxStates.Open }\n  },\n  [ActionTypes.SetDisabled](state, action) {\n    if (state.disabled === action.disabled) return state\n    return { ...state, disabled: action.disabled }\n  },\n  [ActionTypes.GoToOption](state, action) {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Closed) return state\n\n    let activeOptionIndex = calculateActiveIndex(action, {\n      resolveItems: () => state.options,\n      resolveActiveIndex: () => state.activeOptionIndex,\n      resolveId: item => item.id,\n      resolveDisabled: item => item.dataRef.current.disabled,\n    })\n\n    if (state.searchQuery === '' && state.activeOptionIndex === activeOptionIndex) return state\n    return { ...state, searchQuery: '', activeOptionIndex }\n  },\n  [ActionTypes.Search]: (state, action) => {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Closed) return state\n\n    let searchQuery = state.searchQuery + action.value.toLowerCase()\n    let match = state.options.findIndex(\n      option =>\n        !option.dataRef.current.disabled &&\n        option.dataRef.current.textValue?.startsWith(searchQuery)\n    )\n\n    if (match === -1 || match === state.activeOptionIndex) return { ...state, searchQuery }\n    return { ...state, searchQuery, activeOptionIndex: match }\n  },\n  [ActionTypes.ClearSearch](state) {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Closed) return state\n    if (state.searchQuery === '') return state\n    return { ...state, searchQuery: '' }\n  },\n  [ActionTypes.RegisterOption]: (state, action) => ({\n    ...state,\n    options: [...state.options, { id: action.id, dataRef: action.dataRef }],\n  }),\n  [ActionTypes.UnregisterOption]: (state, action) => {\n    let nextOptions = state.options.slice()\n    let currentActiveOption =\n      state.activeOptionIndex !== null ? nextOptions[state.activeOptionIndex] : null\n\n    let idx = nextOptions.findIndex(a => a.id === action.id)\n\n    if (idx !== -1) nextOptions.splice(idx, 1)\n\n    return {\n      ...state,\n      options: nextOptions,\n      activeOptionIndex: (() => {\n        if (idx === state.activeOptionIndex) return null\n        if (currentActiveOption === null) return null\n\n        // If we removed the option before the actual active index, then it would be out of sync. To\n        // fix this, we will find the correct (new) index position.\n        return nextOptions.indexOf(currentActiveOption)\n      })(),\n    }\n  },\n  [ActionTypes.ChangeValue]: (state, action) => {\n    return {\n      ...state,\n      value: action.value,\n    }\n  },\n}\n\nlet ListboxContext = createContext<[StateDefinition, Dispatch<Actions>] | null>(null)\nListboxContext.displayName = 'ListboxContext'\n\nfunction useListboxContext(component: string) {\n  let context = useContext(ListboxContext)\n  if (context === null) {\n    let err = new Error(`<${component} /> is missing a parent <${Listbox.name} /> component.`)\n    if (Error.captureStackTrace) Error.captureStackTrace(err, useListboxContext)\n    throw err\n  }\n  return context\n}\n\nfunction stateReducer(state: StateDefinition, action: Actions) {\n  return match(action.type, reducers, state, action)\n}\n\n// ---\n\nlet DEFAULT_LISTBOX_TAG = Fragment\ninterface ListboxRenderPropArg {\n  open: boolean\n  disabled: boolean\n  onChange: Function\n}\n\nexport function Listbox<\n  TTag extends ElementType = typeof DEFAULT_LISTBOX_TAG,\n  TType = string | Array<string>\n>(\n  props: Props<TTag, ListboxRenderPropArg, 'value' | 'onChange'> & {\n    value: TType\n    onChange(value: TType): void\n    disabled?: boolean\n  }\n) {\n  let { value, onChange: _onChange, disabled = false, ...passThroughProps } = props\n  // Handle value change for single and multiple values\n  const onChange = useCallback(\n    changedOption => {\n      const newValue = Array.isArray(value)\n        ? value.includes(changedOption)\n          ? value.filter(option => option !== changedOption)\n          : [...value, changedOption]\n        : changedOption\n      _onChange(newValue)\n    },\n    [value, _onChange]\n  )\n  let reducerBag = useReducer(stateReducer, {\n    value,\n    listboxState: ListboxStates.Closed,\n    propsRef: { current: { value, onChange } },\n    labelRef: createRef(),\n    buttonRef: createRef(),\n    optionsRef: createRef(),\n    disabled,\n    options: [],\n    searchQuery: '',\n    activeOptionIndex: null,\n  } as StateDefinition)\n  let [{ listboxState, propsRef, optionsRef, buttonRef }, dispatch] = reducerBag\n\n  useIsoMorphicEffect(() => {\n    dispatch({ type: ActionTypes.ChangeValue, value })\n  }, [value])\n  useIsoMorphicEffect(() => {\n    propsRef.current.onChange = onChange\n  }, [onChange, propsRef])\n  useIsoMorphicEffect(() => dispatch({ type: ActionTypes.SetDisabled, disabled }), [disabled])\n\n  // Handle outside click\n  useWindowEvent('mousedown', event => {\n    let target = event.target as HTMLElement\n\n    if (listboxState !== ListboxStates.Open) return\n\n    if (buttonRef.current?.contains(target)) return\n    if (optionsRef.current?.contains(target)) return\n\n    dispatch({ type: ActionTypes.CloseListbox })\n\n    if (!isFocusableElement(target, FocusableMode.Loose)) {\n      event.preventDefault()\n      buttonRef.current?.focus()\n    }\n  })\n\n  let slot = useMemo<ListboxRenderPropArg>(\n    () => ({ open: listboxState === ListboxStates.Open, disabled, onChange }),\n    [listboxState, disabled, onChange]\n  )\n\n  return (\n    <ListboxContext.Provider value={reducerBag}>\n      <OpenClosedProvider\n        value={match(listboxState, {\n          [ListboxStates.Open]: State.Open,\n          [ListboxStates.Closed]: State.Closed,\n        })}\n      >\n        {render({\n          props: passThroughProps,\n          slot,\n          defaultTag: DEFAULT_LISTBOX_TAG,\n          name: 'Listbox',\n        })}\n      </OpenClosedProvider>\n    </ListboxContext.Provider>\n  )\n}\n\n// ---\n\nlet DEFAULT_BUTTON_TAG = 'button' as const\ninterface ButtonRenderPropArg {\n  open: boolean\n  disabled: boolean\n}\ntype ButtonPropsWeControl =\n  | 'id'\n  | 'type'\n  | 'aria-haspopup'\n  | 'aria-controls'\n  | 'aria-expanded'\n  | 'aria-labelledby'\n  | 'disabled'\n  | 'onKeyDown'\n  | 'onClick'\n\nlet Button = forwardRefWithAs(function Button<TTag extends ElementType = typeof DEFAULT_BUTTON_TAG>(\n  props: Props<TTag, ButtonRenderPropArg, ButtonPropsWeControl>,\n  ref: Ref<HTMLButtonElement>\n) {\n  let [state, dispatch] = useListboxContext([Listbox.name, Button.name].join('.'))\n  let buttonRef = useSyncRefs(state.buttonRef, ref)\n\n  let id = `headlessui-listbox-button-${useId()}`\n  let d = useDisposables()\n\n  let handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLButtonElement>) => {\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-13\n\n        case Keys.Space:\n        case Keys.Enter:\n        case Keys.ArrowDown:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.OpenListbox })\n          d.nextFrame(() => {\n            if (!state.value) dispatch({ type: ActionTypes.GoToOption, focus: Focus.First })\n          })\n          break\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.OpenListbox })\n          d.nextFrame(() => {\n            if (!state.value) dispatch({ type: ActionTypes.GoToOption, focus: Focus.Last })\n          })\n          break\n      }\n    },\n    [dispatch, state, d]\n  )\n\n  let handleKeyUp = useCallback((event: ReactKeyboardEvent<HTMLButtonElement>) => {\n    switch (event.key) {\n      case Keys.Space:\n        // Required for firefox, event.preventDefault() in handleKeyDown for\n        // the Space key doesn't cancel the handleKeyUp, which in turn\n        // triggers a *click*.\n        event.preventDefault()\n        break\n    }\n  }, [])\n\n  let handleClick = useCallback(\n    (event: ReactMouseEvent) => {\n      if (isDisabledReactIssue7711(event.currentTarget)) return event.preventDefault()\n      if (state.listboxState === ListboxStates.Open) {\n        dispatch({ type: ActionTypes.CloseListbox })\n        d.nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n      } else {\n        event.preventDefault()\n        dispatch({ type: ActionTypes.OpenListbox })\n      }\n    },\n    [dispatch, d, state]\n  )\n\n  let labelledby = useComputed(() => {\n    if (!state.labelRef.current) return undefined\n    return [state.labelRef.current.id, id].join(' ')\n  }, [state.labelRef.current, id])\n\n  let slot = useMemo<ButtonRenderPropArg>(\n    () => ({ open: state.listboxState === ListboxStates.Open, disabled: state.disabled }),\n    [state]\n  )\n  let passthroughProps = props\n  let propsWeControl = {\n    ref: buttonRef,\n    id,\n    type: 'button',\n    'aria-haspopup': true,\n    'aria-controls': state.optionsRef.current?.id,\n    'aria-expanded': state.disabled ? undefined : state.listboxState === ListboxStates.Open,\n    'aria-labelledby': labelledby,\n    disabled: state.disabled,\n    onKeyDown: handleKeyDown,\n    onKeyUp: handleKeyUp,\n    onClick: handleClick,\n  }\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_BUTTON_TAG,\n    name: 'Listbox.Button',\n  })\n})\n\n// ---\n\nlet DEFAULT_LABEL_TAG = 'label' as const\ninterface LabelRenderPropArg {\n  open: boolean\n  disabled: boolean\n}\ntype LabelPropsWeControl = 'id' | 'ref' | 'onClick'\n\nfunction Label<TTag extends ElementType = typeof DEFAULT_LABEL_TAG>(\n  props: Props<TTag, LabelRenderPropArg, LabelPropsWeControl>\n) {\n  let [state] = useListboxContext([Listbox.name, Label.name].join('.'))\n  let id = `headlessui-listbox-label-${useId()}`\n\n  let handleClick = useCallback(() => state.buttonRef.current?.focus({ preventScroll: true }), [\n    state.buttonRef,\n  ])\n\n  let slot = useMemo<LabelRenderPropArg>(\n    () => ({ open: state.listboxState === ListboxStates.Open, disabled: state.disabled }),\n    [state]\n  )\n  let propsWeControl = { ref: state.labelRef, id, onClick: handleClick }\n  return render({\n    props: { ...props, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_LABEL_TAG,\n    name: 'Listbox.Label',\n  })\n}\n\n// ---\n\nlet DEFAULT_OPTIONS_TAG = 'ul' as const\ninterface OptionsRenderPropArg {\n  open: boolean\n}\ntype OptionsPropsWeControl =\n  | 'aria-activedescendant'\n  | 'aria-labelledby'\n  | 'id'\n  | 'onKeyDown'\n  | 'role'\n  | 'tabIndex'\n\nlet OptionsRenderFeatures = Features.RenderStrategy | Features.Static\n\nlet Options = forwardRefWithAs(function Options<\n  TTag extends ElementType = typeof DEFAULT_OPTIONS_TAG\n>(\n  props: Props<TTag, OptionsRenderPropArg, OptionsPropsWeControl> &\n    PropsForFeatures<typeof OptionsRenderFeatures>,\n  ref: Ref<HTMLUListElement>\n) {\n  let [state, dispatch] = useListboxContext([Listbox.name, Options.name].join('.'))\n  let optionsRef = useSyncRefs(state.optionsRef, ref)\n\n  let id = `headlessui-listbox-options-${useId()}`\n  let d = useDisposables()\n  let searchDisposables = useDisposables()\n\n  let usesOpenClosedState = useOpenClosed()\n  let visible = (() => {\n    if (usesOpenClosedState !== null) {\n      return usesOpenClosedState === State.Open\n    }\n\n    return state.listboxState === ListboxStates.Open\n  })()\n\n  useIsoMorphicEffect(() => {\n    let container = state.optionsRef.current\n    if (!container) return\n    if (state.listboxState !== ListboxStates.Open) return\n    if (container === document.activeElement) return\n\n    container.focus({ preventScroll: true })\n  }, [state.listboxState, state.optionsRef])\n\n  let handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLUListElement>) => {\n      searchDisposables.dispose()\n\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-12\n\n        // @ts-expect-error Fallthrough is expected here\n        case Keys.Space:\n          if (state.searchQuery !== '') {\n            event.preventDefault()\n            event.stopPropagation()\n            return dispatch({ type: ActionTypes.Search, value: event.key })\n          }\n        // When in type ahead mode, fallthrough\n        case Keys.Enter:\n          event.preventDefault()\n          event.stopPropagation()\n          if (!Array.isArray(state.value)) {\n            // Close only for single-value mode\n            dispatch({ type: ActionTypes.CloseListbox })\n          }\n          if (state.activeOptionIndex !== null) {\n            let { dataRef } = state.options[state.activeOptionIndex]\n            state.propsRef.current.onChange(dataRef.current.value)\n          }\n          if (!Array.isArray(state.value)) {\n            // Focus only for single-value mode\n            disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n          }\n          break\n\n        case Keys.ArrowDown:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Next })\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Previous })\n\n        case Keys.Home:\n        case Keys.PageUp:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.First })\n\n        case Keys.End:\n        case Keys.PageDown:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Last })\n\n        case Keys.Escape:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.CloseListbox })\n          return d.nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n\n        case Keys.Tab:\n          event.preventDefault()\n          event.stopPropagation()\n          break\n\n        default:\n          if (event.key.length === 1) {\n            dispatch({ type: ActionTypes.Search, value: event.key })\n            searchDisposables.setTimeout(() => dispatch({ type: ActionTypes.ClearSearch }), 350)\n          }\n          break\n      }\n    },\n    [d, dispatch, searchDisposables, state]\n  )\n\n  let labelledby = useComputed(() => state.labelRef.current?.id ?? state.buttonRef.current?.id, [\n    state.labelRef.current,\n    state.buttonRef.current,\n  ])\n\n  let slot = useMemo<OptionsRenderPropArg>(\n    () => ({ open: state.listboxState === ListboxStates.Open }),\n    [state]\n  )\n  let propsWeControl = {\n    'aria-activedescendant':\n      state.activeOptionIndex === null ? undefined : state.options[state.activeOptionIndex]?.id,\n    'aria-labelledby': labelledby,\n    id,\n    onKeyDown: handleKeyDown,\n    role: 'listbox',\n    tabIndex: 0,\n    ref: optionsRef,\n  }\n  let passthroughProps = props\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_OPTIONS_TAG,\n    features: OptionsRenderFeatures,\n    visible,\n    name: 'Listbox.Options',\n  })\n})\n\n// ---\n\nlet DEFAULT_OPTION_TAG = 'li' as const\ninterface OptionRenderPropArg {\n  active: boolean\n  selected: boolean\n  disabled: boolean\n}\ntype ListboxOptionPropsWeControl =\n  | 'id'\n  | 'role'\n  | 'tabIndex'\n  | 'aria-disabled'\n  | 'aria-selected'\n  | 'onPointerLeave'\n  | 'onMouseLeave'\n  | 'onPointerMove'\n  | 'onMouseMove'\n  | 'onFocus'\n\nfunction Option<\n  TTag extends ElementType = typeof DEFAULT_OPTION_TAG,\n  // TODO: One day we will be able to infer this type from the generic in Listbox itself.\n  // But today is not that day..\n  TType = Parameters<typeof Listbox>[0]['value']\n>(\n  props: Props<TTag, OptionRenderPropArg, ListboxOptionPropsWeControl | 'value'> & {\n    disabled?: boolean\n    value: TType\n  }\n) {\n  let { disabled = false, value, ...passthroughProps } = props\n  let [state, dispatch] = useListboxContext([Listbox.name, Option.name].join('.'))\n  let id = `headlessui-listbox-option-${useId()}`\n  let active =\n    state.activeOptionIndex !== null ? state.options[state.activeOptionIndex].id === id : false\n\n  let selected = Array.isArray(state.value) ? state.value.includes(value) : state.value === value\n\n  let bag = useRef<ListboxOptionDataRef['current']>({ disabled, value })\n\n  useIsoMorphicEffect(() => {\n    bag.current.disabled = disabled\n  }, [bag, disabled])\n  useIsoMorphicEffect(() => {\n    bag.current.value = value\n  }, [bag, value])\n  useIsoMorphicEffect(() => {\n    bag.current.textValue = document.getElementById(id)?.textContent?.toLowerCase()\n  }, [bag, id])\n\n  let select = useCallback(() => {\n    state.propsRef.current.onChange(value)\n  }, [state.propsRef, value])\n\n  useIsoMorphicEffect(() => {\n    dispatch({ type: ActionTypes.RegisterOption, id, dataRef: bag })\n    return () => dispatch({ type: ActionTypes.UnregisterOption, id })\n  }, [bag, id])\n\n  useIsoMorphicEffect(() => {\n    if (state.listboxState !== ListboxStates.Open) return\n    if (!selected) return\n    if (!Array.isArray(state.value)) {\n      dispatch({ type: ActionTypes.GoToOption, focus: Focus.Specific, id })\n      document.getElementById(id)?.focus?.()\n    }\n  }, [state.listboxState])\n\n  useIsoMorphicEffect(() => {\n    if (state.listboxState !== ListboxStates.Open) return\n    if (!active) return\n    let d = disposables()\n    d.nextFrame(() => document.getElementById(id)?.scrollIntoView?.({ block: 'nearest' }))\n    return d.dispose\n  }, [id, active, state.listboxState])\n\n  let handleClick = useCallback(\n    (event: { preventDefault: Function }) => {\n      if (disabled) return event.preventDefault()\n      select()\n      if (!Array.isArray(state.value)) {\n        dispatch({ type: ActionTypes.CloseListbox })\n        disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n      }\n    },\n    [dispatch, state.buttonRef, state.value, disabled, select]\n  )\n\n  let handleFocus = useCallback(() => {\n    if (disabled) return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Nothing })\n    dispatch({ type: ActionTypes.GoToOption, focus: Focus.Specific, id })\n  }, [disabled, id, dispatch])\n\n  let handleMove = useCallback(() => {\n    if (disabled) return\n    if (active) return\n    dispatch({ type: ActionTypes.GoToOption, focus: Focus.Specific, id })\n  }, [disabled, active, id, dispatch])\n\n  let handleLeave = useCallback(() => {\n    if (disabled) return\n    if (!active) return\n    dispatch({ type: ActionTypes.GoToOption, focus: Focus.Nothing })\n  }, [disabled, active, dispatch])\n\n  let slot = useMemo<OptionRenderPropArg>(() => ({ active, selected, disabled }), [\n    active,\n    selected,\n    disabled,\n  ])\n  let propsWeControl = {\n    id,\n    role: 'option',\n    tabIndex: disabled === true ? undefined : -1,\n    'aria-disabled': disabled === true ? true : undefined,\n    'aria-selected': selected === true ? true : undefined,\n    disabled: undefined, // Never forward the `disabled` prop\n    onClick: handleClick,\n    onFocus: handleFocus,\n    onPointerMove: handleMove,\n    onMouseMove: handleMove,\n    onPointerLeave: handleLeave,\n    onMouseLeave: handleLeave,\n  }\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_OPTION_TAG,\n    name: 'Listbox.Option',\n  })\n}\n\n// ---\n\nListbox.Button = Button\nListbox.Label = Label\nListbox.Options = Options\nListbox.Option = Option\n"],"names":["ListboxStates","ActionTypes","reducers","CloseListbox","state","disabled","listboxState","Closed","activeOptionIndex","OpenListbox","Open","SetDisabled","action","GoToOption","calculateActiveIndex","resolveItems","options","resolveActiveIndex","resolveId","item","id","resolveDisabled","dataRef","current","searchQuery","Search","value","toLowerCase","match","findIndex","option","textValue","startsWith","ClearSearch","RegisterOption","UnregisterOption","nextOptions","slice","currentActiveOption","idx","a","splice","indexOf","ChangeValue","ListboxContext","createContext","displayName","useListboxContext","component","context","useContext","err","Error","Listbox","name","captureStackTrace","stateReducer","type","DEFAULT_LISTBOX_TAG","Fragment","props","_onChange","onChange","passThroughProps","useCallback","changedOption","newValue","Array","isArray","includes","filter","reducerBag","useReducer","propsRef","labelRef","createRef","buttonRef","optionsRef","dispatch","useIsoMorphicEffect","useWindowEvent","event","target","contains","isFocusableElement","FocusableMode","Loose","preventDefault","focus","slot","useMemo","open","React","Provider","OpenClosedProvider","State","render","defaultTag","DEFAULT_BUTTON_TAG","Button","forwardRefWithAs","ref","join","useSyncRefs","useId","d","useDisposables","handleKeyDown","key","Keys","Space","Enter","ArrowDown","nextFrame","Focus","First","ArrowUp","Last","handleKeyUp","handleClick","isDisabledReactIssue7711","currentTarget","preventScroll","labelledby","useComputed","undefined","passthroughProps","propsWeControl","onKeyDown","onKeyUp","onClick","DEFAULT_LABEL_TAG","Label","DEFAULT_OPTIONS_TAG","OptionsRenderFeatures","Features","RenderStrategy","Static","Options","searchDisposables","usesOpenClosedState","useOpenClosed","visible","container","document","activeElement","dispose","stopPropagation","disposables","Next","Previous","Home","PageUp","End","PageDown","Escape","Tab","length","setTimeout","role","tabIndex","features","DEFAULT_OPTION_TAG","Option","active","selected","bag","useRef","getElementById","textContent","select","Specific","scrollIntoView","block","handleFocus","Nothing","handleMove","handleLeave","onFocus","onPointerMove","onMouseMove","onPointerLeave","onMouseLeave"],"mappings":"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"}